{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LavaMoat Policy Schema",
  "type": "object",
  "$id": "lavamoat-policy.v0-0-1",
  "properties": {
    "resources": {
      "type": "object",
      "$comment": "This one or more valid npm package names delimited by a \">\" character, or the special case \"<root>\"",
      "properties": {
        "<root>": {
          "$ref": "#/$defs/resourcePolicy"
        }
      },
      "patternProperties": {
        "^(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*(>(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*)*$": {
          "$ref": "#/$defs/resourcePolicy"
        }
      },
      "allowAdditionalProperties": false
    },
    "resolutions": {
      "type": "object",
      "patternProperties": {
        "^(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*(>(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*)*$": {
          "type": "object",
          "^(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*(>(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*)*$": {
            "type": "string",
            "pattern": "^/$|(^(?=/)|^\\.|^\\.\\.)(/(?=[^/\\0])[^/\\0]+)*/?$",
            "minLength": 1,
            "description": "Relative POSIX path to module from package root"
          }
        },
        "allowAdditionalProperties": false
      }
    }
  },
  "required": ["resources"],
  "$defs": {
    "resourcePolicy": {
      "type": "object",
      "properties": {
        "globals": {
          "type": "object",
          "$comment": "A global property key can be any string (accessible via bracket notation)",
          "additionalProperties": {
            "type": "boolean"
          }
        },
        "builtins": {
          "type": "object",
          "$comment": "I don't think narrowing the possible values here is feasible (or maintainable)",
          "additionalProperties": {
            "type": "boolean"
          }
        },
        "packages": {
          "type": "object",
          "$comment": "This one or more valid npm package names delimited by a \">\" character",
          "patternProperties": {
            "^(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*(>(@[a-z0-9-~][a-z0-9-._~]*/)?[a-z0-9-~][a-z0-9-._~]*)*$": {
              "type": "boolean"
            }
          },
          "allowAdditionalProperties": false
        }
      },
      "allowAdditionalProperties": false
    }
  }
}
